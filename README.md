# private-isu-training

## 概要

[private-isu](https://github.com/catatsuy/private-isu)を用いて練習した際のメモ

## 前提

- AWSのアカウントを持っていること
- EC2インスタンスの作成/SSH接続/削除に関する基本的な知識があること

## 練習時の環境構築メモ

[AMI]((https://github.com/catatsuy/private-isu#ami))を用いて環境構築をした。

- AWSのセキュリティグループとキーペアは事前に作成しておいた
  - セキュリティグループ
    - インバウンドルールを自身の手元のIPアドレスを許可するようにしておく
    - アウトバウンドルールは全て許可するようにしておく
    - インスタンスを作成後に、各EC2インスタンス同士のアクセスも許可するようにしておく
    - 面倒くさければ、全てのIPアドレスを許可するようにしておく
  - キーペア
    - 事前に作成し、pemファイルをダウンロードしておく
    - 後でSSH接続する際に使用する
- AWSマネジメントコンソールを開き、上記のAMI(x86)を利用してEC2インスタンスを2個作成した
  - 用途は「ベンチマーク実行用」と「アプリケーションサーバ+DBサーバー用」
    - アプリケーションサーバとDBサーバを分離する工夫をする場合は、追加でインスタンスを作成する必要
  - 終了後はインスタンスを削除すること
  - コストを確認の上、インスタンスを選択すること
    - 初めは`t2.micro`(1時間約$0.01)で試した
      - ただし、動作確認レベル(EC2の立ち上げ、接続確認、ベンチマークの初回実行)でしか使えない
      - ベンチマークを実行し続けるとフリーズするので、本格的にやる場合は`c5.large`(1時間約$0.1)
    - 推奨されているのは`c7a.large`(1時間約$0.12)

### SSH接続

~/.ssh/configに下記の設定を追記した

```bash
Host 適当な名前(例: private-isu-bench)
  HostName インスタンスのパブリックIPv4 DNS(ec2-111-222-3-4.ap-northeast-1.compute.amazonaws.com)
  IdentityFile ~/.ssh/key_name.pem
  User ubuntu(マニュアルに書いてある)
```

vscodeにRemote-SSHをインストールし、上記の設定のHostにSSH接続した。

参考: [マニュアル](https://github.com/catatsuy/private-isu/blob/master/manual.md)

### アプリの起動確認

http://[インスタンスのパブリックIP]にアクセスし、アプリが起動していることを確認した

### ベンチマークの実行

[private-isuのマニュアル](https://github.com/catatsuy/private-isu/blob/17a5955243cb638cfaf7b901a4ad8ee74402576d/README.md?plain=1#L64-L69)に従って、ベンチマークを実行した。

- まずは競技者用インスタンス上でのベンチマーカーを実行(アプリケーションが動いているかの確認)
- それが上手くいったら、ベンチマーカーをベンチマーク用インスタンス上で実行(インスタンス同士の接続確認)
